-- SERVICES
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")

-- CALLBACKS
local callbacks = {
    OnTogglePlayerList = function(open) end,
    OnPlayerSelected = function(playerName) end,
}

-- GUI CREATION
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MyInjectorUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = game:GetService("CoreGui")

-- OUTER FRAME WITH GRADIENT TOP BAR
local OutlineFrame = Instance.new("Frame")
OutlineFrame.Size = UDim2.new(0.4, 4, 0, 44)
OutlineFrame.Position = UDim2.new(0.3, -2, 0, 0)
OutlineFrame.BackgroundTransparency = 1
OutlineFrame.Parent = ScreenGui

local GradientOutline = Instance.new("UIGradient")
GradientOutline.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 255)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 255, 255)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 0, 255))
}
GradientOutline.Rotation = 90
GradientOutline.Parent = OutlineFrame

local TopBar = Instance.new("Frame")
TopBar.Size = UDim2.new(1, 0, 0, 50)
TopBar.BackgroundColor3 = Color3.fromRGB(34,34,34)
TopBar.BackgroundTransparency = 0.3
TopBar.Parent = OutlineFrame

Instance.new("UICorner", TopBar).CornerRadius = UDim.new(0,8)

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Size = UDim2.new(0, 150, 1, 0)
TitleLabel.Position = UDim2.new(0,10,0,0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "My GUI"
TitleLabel.TextColor3 = Color3.new(1,1,1)
TitleLabel.Font = Enum.Font.SourceSansBold
TitleLabel.TextSize = 20
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
TitleLabel.Parent = TopBar

local PlayerListButton = Instance.new("TextButton")
PlayerListButton.Size = UDim2.new(0,40,0,40)
PlayerListButton.Position = UDim2.new(0.5,-20,0.5,-20)
PlayerListButton.BackgroundColor3 = Color3.fromRGB(85,170,255)
PlayerListButton.Text = "ðŸ‘¤"
PlayerListButton.TextColor3 = Color3.new(1,1,1)
PlayerListButton.Font = Enum.Font.SourceSans
PlayerListButton.TextSize = 20
PlayerListButton.Parent = TopBar
Instance.new("UICorner", PlayerListButton).CornerRadius = UDim.new(0,8)

local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0,30,0,30)
CloseButton.Position = UDim2.new(1,-30,0,0)
CloseButton.AnchorPoint = Vector2.new(1,0)
CloseButton.BackgroundColor3 = Color3.fromRGB(255,0,0)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.new(1,1,1)
CloseButton.Font = Enum.Font.SourceSansBold
CloseButton.TextSize = 20
CloseButton.Parent = TopBar
Instance.new("UICorner", CloseButton).CornerRadius = UDim.new(0,4)

-- PLAYER LIST FRAME
local PlayerListFrame = Instance.new("Frame")
PlayerListFrame.Size = UDim2.new(0,200,0,300)
PlayerListFrame.Position = UDim2.new(0.5,-100,0.5,-150)
PlayerListFrame.BackgroundColor3 = Color3.fromRGB(20,20,20)
PlayerListFrame.BorderSizePixel = 0
PlayerListFrame.Visible = false
PlayerListFrame.Parent = ScreenGui
Instance.new("UICorner", PlayerListFrame).CornerRadius = UDim.new(0,8)

local PlayerListTitle = Instance.new("TextLabel")
PlayerListTitle.Size = UDim2.new(1,0,0,30)
PlayerListTitle.Position = UDim2.new(0,0,0,0)
PlayerListTitle.BackgroundTransparency = 1
PlayerListTitle.Text = "Player List"
PlayerListTitle.TextColor3 = Color3.new(1,1,1)
PlayerListTitle.Font = Enum.Font.SourceSansBold
PlayerListTitle.TextSize = 18
PlayerListTitle.Parent = PlayerListFrame

local MinimizePL = Instance.new("TextButton")
MinimizePL.Size = UDim2.new(0,30,0,30)
MinimizePL.Position = UDim2.new(1,-35,0,0)
MinimizePL.AnchorPoint = Vector2.new(1,0)
MinimizePL.BackgroundTransparency = 1
MinimizePL.Text = "â€“"
MinimizePL.TextColor3 = Color3.new(1,1,1)
MinimizePL.Font = Enum.Font.SourceSansBold
MinimizePL.TextSize = 24
MinimizePL.Parent = PlayerListFrame

local listLayout = Instance.new("UIListLayout")
listLayout.Parent = PlayerListFrame
listLayout.Padding = UDim.new(0,5)
listLayout.SortOrder = Enum.SortOrder.LayoutOrder

-- PLAYER OPTIONS FRAME
local PlayerOptionsFrame = Instance.new("Frame")
PlayerOptionsFrame.Size = UDim2.new(0,200,0,100)
PlayerOptionsFrame.BackgroundColor3 = Color3.fromRGB(40,40,40)
PlayerOptionsFrame.BorderSizePixel = 0
PlayerOptionsFrame.Visible = false
PlayerOptionsFrame.Parent = ScreenGui
Instance.new("UICorner", PlayerOptionsFrame).CornerRadius = UDim.new(0,8)

local PlayerOptionsTitle = Instance.new("TextLabel")
PlayerOptionsTitle.Size = UDim2.new(1,0,0,30)
PlayerOptionsTitle.Position = UDim2.new(0,0,0,0)
PlayerOptionsTitle.BackgroundTransparency = 1
PlayerOptionsTitle.Text = "Player Options"
PlayerOptionsTitle.TextColor3 = Color3.new(1,1,1)
PlayerOptionsTitle.Font = Enum.Font.SourceSansBold
PlayerOptionsTitle.TextSize = 16
PlayerOptionsTitle.Parent = PlayerOptionsFrame

local MinimizePO = Instance.new("TextButton")
MinimizePO.Size = UDim2.new(0,30,0,30)
MinimizePO.Position = UDim2.new(1,-35,0,0)
MinimizePO.AnchorPoint = Vector2.new(1,0)
MinimizePO.BackgroundTransparency = 1
MinimizePO.Text = "â€“"
MinimizePO.TextColor3 = Color3.new(1,1,1)
MinimizePO.Font = Enum.Font.SourceSansBold
MinimizePO.TextSize = 24
MinimizePO.Parent = PlayerOptionsFrame

local TpButton = Instance.new("TextButton")
TpButton.Size = UDim2.new(1,-10,0,30)
TpButton.Position = UDim2.new(0,5,0,35)
TpButton.BackgroundTransparency = 1
TpButton.Text = "TP to player"
TpButton.TextColor3 = Color3.new(1,1,1)
TpButton.Font = Enum.Font.SourceSans
TpButton.TextSize = 14
TpButton.Parent = PlayerOptionsFrame

-- VARIABLES
local TpPlayerName

-- REFRESH PLAYER LIST
local function refreshPlayerList()
    for _, child in ipairs(PlayerListFrame:GetChildren()) do
        if child:IsA("TextButton") and child ~= MinimizePL then
            child:Destroy()
        end
    end
    for _, pl in ipairs(Players:GetPlayers()) do
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(1,-10,0,20)
        btn.BackgroundTransparency = 1
        btn.Text = pl.Name
        btn.TextColor3 = Color3.new(1,1,1)
        btn.Font = Enum.Font.SourceSans
        btn.TextSize = 14
        btn.Parent = PlayerListFrame
        btn.MouseButton1Click:Connect(function()
            TpPlayerName = pl.Name
            PlayerOptionsTitle.Text = pl.Name
            PlayerOptionsFrame.Visible = true
        end)
    end
end

Players.PlayerAdded:Connect(refreshPlayerList)
Players.PlayerRemoving:Connect(refreshPlayerList)
refreshPlayerList()

-- DRAG FUNCTION
local function makeDraggable(fr)
    local dragging, startPos, startInput
    fr.InputBegan:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            startPos = fr.Position
            startInput = i.Position
            i.Changed:Connect(function()
                if i.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    UserInputService.InputChanged:Connect(function(i)
        if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = i.Position - startInput
            fr.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X,
                                     startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            PlayerOptionsFrame.Position = UDim2.new(
                fr.Position.X.Scale, fr.Position.X.Offset + fr.Size.X.Offset + 5,
                fr.Position.Y.Scale, fr.Position.Y.Offset
            )
        end
    end)
end

makeDraggable(PlayerListFrame)

-- BUTTON HANDLERS
CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

PlayerListButton.MouseButton1Click:Connect(function()
    local show = not PlayerListFrame.Visible
    PlayerListFrame.Visible = show
    if not show then PlayerOptionsFrame.Visible = false end
    callbacks.OnTogglePlayerList(show)
end)

MinimizePL.MouseButton1Click:Connect(function()
    PlayerListFrame.Visible = false
    PlayerOptionsFrame.Visible = false
end)

MinimizePO.MouseButton1Click:Connect(function()
    PlayerOptionsFrame.Visible = false
end)

TpButton.MouseButton1Click:Connect(function()
    if TpPlayerName then
        local tp = Players:FindFirstChild(TpPlayerName)
        local lp = Players.LocalPlayer
        if tp and tp.Character and tp.Character:FindFirstChild("HumanoidRootPart") and
           lp and lp.Character and lp.Character:FindFirstChild("HumanoidRootPart") then
            local targetHRP = tp.Character.HumanoidRootPart
            lp.Character.HumanoidRootPart.CFrame =
                targetHRP.CFrame + Vector3.new(0, 3, 0)
        end
    end
end)
